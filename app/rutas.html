<html>
  <head>
    <title>BAMTY - TRAFICO</title>
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="../css/materialize.min.css"  media="screen,projection"/>
    <meta charset="UTF-8"></meta>
  </head>
  <body>
    <div class="row">
      <div>
        <ul id="slide-out" class="side-nav fixed teal">
          <div class="section">
            <img class="responsive-img" src="../img/logo.png"/>
          </div>
          <a href="./app.html" class="waves-effect waves-light btn black-text teal"><i class="mdi-action-dashboard left"></i>Dashboard</a>
          <a href="#" class="waves-effect waves-light btn black-text teal"><i class="mdi-maps-directions left"></i>Rutas</a>
          <a href="./choferes.html" class="waves-effect waves-light btn black-text teal"><i class="mdi-social-person left"></i>Choferes</a>
          <a href="./vehiculos.html" class="waves-effect waves-light btn black-text teal"><i class="mdi-maps-local-shipping left"></i>Vehiculos</a>

          <div class="section" style="margin-top: 300px;">
            <div class="row">
              <div class="col s6"><a href="../index.html" class="waves-effect waves-light btn black-text grey">logout</a></div>
              <div class="col s6"><a class="waves-effect waves-light btn black-text grey">exit</a></div>
            </div>
          </div>
       </ul>
       <a href="#" data-activates="slide-out" class="button-collapse"><i class="mdi-navigation-menu"></i></a>
      </div>

      <div class="col s10 offset-s2">
        <nav>
          <div class="nav-wrapper teal">
            <a href="#" class="brand-logo center">Rutas disponibles</a>
          </div>
        </nav>
        <table class="hoverable" id="calendario">
          <thead>
            <tr>
                <th data-field="id">Ruta</th>
                <th data-field="tienda">Tienda Sucursal</th>
                <th data-field="frecuencia">Tipo de Visita</th>
                <th></th>
                <th data-field="lunes">Lunes</th>
                <th data-field="martes">Martes</th>
                <th data-field="miercoles">Miércoles</th>
                <th data-field="jueves">Jueves</th>
                <th data-field="viernes">Viernes</th>
                <th data-field="sabado">Sábado</th>
                <th data-field="domingo">Domingo</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>R1</td>
              <td>HEB Gonzalitos 2959</td>
              <td>Lu,Jue</td>
              <td><button class="btn waves-effect waves-light center" onclick="editar(this)"><i class="mdi-editor-mode-edit"></i></button></td>
            </tr>
            <tr>
              <td>R1</td>
              <td>HEB Chipinque 2950</td>
              <td>Diaria</td>
              <td><button class="btn waves-effect waves-light center" onclick="editar(this)"><i class="mdi-editor-mode-edit"></i></button></td>
            </tr>
            <tr>
              <td>R1</td>
              <td>HEB San Pedro  2975</td>
              <td>Lu,Mi,Vi</td>
              <td><button class="btn waves-effect waves-light center" onclick="editar(this)"><i class="mdi-editor-mode-edit"></i></button></td>
            </tr>
          </tbody>
        </table>
        <div class="fixed-action-btn" style="bottom: 45px; right: 24px;">
          <a href="#modal1" class="btn-floating btn-large teal tooltipped modal-trigger" data-position="left" data-delay="50" data-tooltip="Agregar ruta">
            <i class="large mdi-content-add"></i></a>
        </div>
      </div>
    </div>
    
  <!-- modal form: alta rutas -->
    <div class="modal" id="modal1">
      <div class="modal-content">
        <h3 class="center">Registrar una nueva ruta</h3>
        <form class="col s12">
          <div class="row">
            <div class="input-field col s6">
              <select>
                <option value="" disabled selected>Escoja una ruta</option>
                <option value="R1">R1</option>
                <option value="R2">R2</option>
                <option value="R3">R3</option>
              </select>
              <label>Ruta</label>
            </div>
            <div class="input-field col s6">
              <input id="tienda" type="text" class="validate">
              <label for="tienda">Tienda Sucursal</label>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s12">
              <p class="tooltipped" data-tooltip="Escoger todos los días que se visitara la sucursal" data-positon="left" data-delay="50">Tipo de Visita</p>
              <input type="checkbox" class="filled-in" id="lunes" name="frecuencia" value ="Lu"/>
              <label for="lunes">Lunes</label>
              <br/>
              <input type="checkbox" class="filled-in" id="martes" name="frecuencia" value ="Mar"/>
              <label for="martes">Martes</label>
              <br/>
              <input type="checkbox" class="filled-in" id="miercoles" name="frecuencia" value ="Mi"/>
              <label for="miercoles">Miércoles</label>
              <br/>
              <input type="checkbox" class="filled-in" id="jueves" name="frecuencia" value ="Jue"/>
              <label for="jueves">Jueves</label>
              <br/>
              <input type="checkbox" class="filled-in" id="viernes" name="frecuencia" value ="Vi"/>
              <label for="viernes">Viernes</label>
              <br/>
              <input type="checkbox" class="filled-in" id="sabado" name="frecuencia" value ="Sab"/>
              <label for="sabado">Sábado</label>
              <br/>
              <input type="checkbox" class="filled-in" id="domingo" name="frecuencia" value ="Dom"/>
              <label for="domingo">Domingo</label>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Submit</a>
        <a href="#!" class="modal-action modal-close waves-effect waves-red btn-flat">Cancel</a>
      </div>
    </div>
  <!-- Termino del modal -->
  
  <!-- modal form: edicion -->
    <script type="text/javascript">
      window.onload = function() {
        calendario();
      }
      function calendario() {
        var length = document.getElementById("calendario").rows.length;
        for(i=1; i<length; i++) {
          var fila = document.getElementById("calendario").rows[i].cells;
          var dias = fila[2].textContent;
          fila = document.getElementById("calendario").rows[i];
          if(dias.search("Diaria") >=0) {
            for(j=0; j<7; j++) {
              x = fila.insertCell(-1);
              x.style.backgroundColor = "#0277bd";
            }
          } else {
            x = fila.insertCell(-1);
            if(dias.search("Lu") >= 0) {
               x.style.backgroundColor = "#0277bd";
            }
            x = fila.insertCell(-1);
            if(dias.search("Mar") >= 0) {
               x.style.backgroundColor = "#0277bd";
            }
            x = fila.insertCell(-1);
            if(dias.search("Mi") >= 0) {
               x.style.backgroundColor = "#0277bd";
            }
            x = fila.insertCell(-1);
            if(dias.search("Jue") >= 0) {
               x.style.backgroundColor = "#0277bd";
            }
            x = fila.insertCell(-1);
            if(dias.search("Vi") >= 0) {
               x.style.backgroundColor = "#0277bd";
            }
            x = fila.insertCell(-1);
            if(dias.search("Sab") >= 0) {
               x.style.backgroundColor = "#0277bd";
            }
            x = fila.insertCell(-1);
            if(dias.search("Dom") >= 0) {
               x.style.backgroundColor = "#0277bd";
            }
          }
        }
        $(document).ready(function() {
          $('select').material_select();
          $('.modal-trigger').leanModal();
        });      
      }
      
      function refreshCalendario() {
         var length = document.getElementById("calendario").rows.length;
        for(i=1; i<length; i++) {
          var fila = document.getElementById("calendario").rows[i].cells;
          var dias = fila[2].textContent;
          if(dias.search("Diaria") >=0) {
            for(j=4; j<11; j++) {
              fila.item(j). style.backgroundColor ="#0277bd";
            }
          } else {
            if(dias.search("Lu") >= 0) {
               fila.item(4).style.backgroundColor ="#0277bd";
            } else {
              fila.item(4).style.backgroundColor ="#ffffff";
            }
            if(dias.search("Mar") >= 0) {
               fila.item(5).style.backgroundColor ="#0277bd";
            } else {
              fila.item(5).style.backgroundColor ="#ffffff";
            }
            if(dias.search("Mi") >= 0) {
               fila.item(6).style.backgroundColor ="#0277bd";
            } else {
              fila.item(6).style.backgroundColor ="#ffffff";
            }
            if(dias.search("Jue") >= 0) {
               fila.item(7).style.backgroundColor ="#0277bd";
            } else {
              fila.item(7).style.backgroundColor ="#ffffff";
            }
            if(dias.search("Vi") >= 0) {
               fila.item(8).style.backgroundColor ="#0277bd";
            } else {
              fila.item(8).style.backgroundColor ="#ffffff";
            }
            if(dias.search("Sab") >= 0) {
               fila.item(9).style.backgroundColor ="#0277bd";
            } else {
              fila.item(9).style.backgroundColor ="#ffffff";
            }
            if(dias.search("Dom") >= 0) {
               fila.item(10).style.backgroundColor ="#0277bd";
            } else {
              fila.item(10).style.backgroundColor ="#ffffff";
            }
          }
        }
      }
      
      <!-- Edicion de registro -->
      function trim(value) {
        var temp = value;
        var obj = /^(\s*)([\W\w]*)(\b\s*$)/;
        if (obj.test(temp)) { temp = temp.replace(obj, '$2');}
        var obj = /  /g;
        while (temp.match(obj)) { temp = temp.replace(obj, " ");}
        return temp;
      }
      
      function getTextWidth(texto) {
        var ancho = 150;

        if(trim(texto) == "") {
            return ancho;
        }
        
        var span = document.createElement("span");
        span.style.visibility = "hidden";
        span.style.position = "absolute";
        span.appendChild(document.createTextNode(texto));
        document.getElementsByTagName("body")[0].appendChild(span);
        ancho = span.offsetWidth;
        document.getElementsByTagName("body")[0].removeChild(span);
        span = null;

        return ancho;
      }

      
      function editar(obj) {
        var ruta = null;
        var tienda = null;
        var frecuencia = null;
        var fila = obj.parentNode.parentNode;
        var campoRuta = fila.firstElementChild;
        var campoTienda = fila.children[1];
        var campoFrecuencia = fila.children[2];
        
        ruta = document.createElement("input");
        if(campoRuta.innerText) {
          ruta.value = campoRuta.innerText;
        } else {
          ruta.value = campoRuta.textContent;
        }
        ruta.style.width = getTextWidth(ruta.value) + 30 + "px";
        campoRuta.replaceChild(ruta, campoRuta.firstChild);
        
        
        tienda = document.createElement("input");
        if(campoTienda.innerText) {
          tienda.value = campoTienda.innerText;
        } else {
          tienda.value = campoTienda.textContent;
        }
        tienda.style.width = getTextWidth(tienda.value) + 30 + "px";
        campoTienda.replaceChild(tienda, campoTienda.firstChild);
        
        
        frecuencia = document.createElement("input");
        if(campoFrecuencia.innerText) {
          frecuencia.value = campoFrecuencia.innerText;
        } else {
          frecuencia.value = campoFrecuencia.textContent;
        }
        frecuencia.style.width = getTextWidth(frecuencia.value) + 30 + "px";
        campoFrecuencia.replaceChild(frecuencia, campoFrecuencia.firstChild);
        
        obj.className = "btn waves-effect waves-light center green";
        obj.firstChild.className = "mdi-content-save";
        obj.onclick = function salir() {
          guardarCambios(obj, ruta.value, tienda.value, frecuencia.value);
          delete ruta;
          delete tienda;
          delete frecuencia;
          refreshCalendario();
        }
      }
      
      function guardarCambios(obj, valorRuta, valorTienda, valorFrecuencia) {
        var fila = obj.parentNode.parentNode;
        var ruta = fila.children[0];
        var tienda = fila.children[1];
        var freq = fila.children[2];
        ruta.replaceChild(document.createTextNode(valorRuta), ruta.firstChild);
        tienda.replaceChild(document.createTextNode(valorTienda), tienda.firstChild);
        freq.replaceChild(document.createTextNode(valorFrecuencia), freq.firstChild);
        obj.className = "btn waves-effect waves-light center";
        obj.firstChild.className = "mdi-editor-mode-edit";
        obj.onclick=function() {editar(this)};
      }
    </script>
    <script src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="../js/materialize.min.js"></script>
    <script src="../js/main.js"></script>
    <script>
      var path = './app/';
      var fs = require('fs');

      fs.watch(path, function() {
        if (location)
          location.reload();
      });
    </script>
  </body>
</html>
