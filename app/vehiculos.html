<html>
  <head>
    <title>BAMTY - TRAFICO</title>
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="../css/materialize.min.css"  media="screen,projection"/>
    <meta charset="UTF-8"></meta>
  </head>
  <body>
    <div class="row">
      <div>
        <ul id="slide-out" class="side-nav fixed teal">
          <div class="section">
            <img class="responsive-img" src="../img/logo.png"/>
          </div>
          <a href="./app.html" class="waves-effect waves-light btn black-text teal"><i class="mdi-action-dashboard left"></i>Dashboard</a>
          <a href="./controldiario.html" class="waves-effect waves-light btn black-text teal"><i class="mdi-action-assignment left"></i>Control - Diario</a>
          <a href="./rutas.html" class="waves-effect waves-light btn black-text teal"><i class="mdi-maps-directions left"></i>Rutas</a>
          <a href="./choferes.html" class="waves-effect waves-light btn black-text teal"><i class="mdi-social-person left"></i>Choferes</a>
          <a href="#" class="waves-effect waves-light btn black-text teal"><i class="mdi-maps-local-shipping left"></i>Vehiculos</a>

          <div class="section" style="margin-top: 300px;">
            <div class="row">
              <div class="col s6"><a href="../index.html" class="waves-effect waves-light btn black-text grey">logout</a></div>
              <div class="col s6"><a id="close" class="waves-effect waves-light btn black-text grey">exit</a></div>
            </div>
          </div>
       </ul>
       <a href="#" data-activates="slide-out" class="button-collapse"><i class="mdi-navigation-menu"></i></a>
      </div>

      <div class="col s10 offset-s2">
        <nav>
          <div class="nav-wrapper teal">
            <a href="#" class="brand-logo center">Vehículos</a>
            <ul id="nav-mobile" class="left hide-on-med-and-down">
              <li class="active"><a href="#">Control</a></li>
              <li><a href="./vehiculos-gasolina.html">Gasolina</a></li>
              <li><a href="./vehiculos-mantenimiento.html">Mantenimientos</a></li>
            </ul>
          </div>
        </nav>
        <table class="hoverable" id="vehiculos">
              <thead>
              <tr>
                  <th data-field="nombre">Nombre</th>
                  <th data-field="marca">Marca</th>
                  <th data-field="modelo">Modelo</th>
                  <th data-field="Descripcion">Descripcion</th>
                  <th data-field="placas">Placas</th>
                  <th data-field="clasificacion">Clasificacion</th>
                  <th data-field="donante">Donante</th>
                  <th data-field="combustible">Combustible</th>
                  <th data-field="noTarjeta">Número de Tarjeta</th>
                  <th data-field="noHolograma">Número de Holograma</th>
                  <th data-field="serie">Número de Serie</th>
                  <th data-field="funcionando">Estatus</th>
              </tr>
              </thead>
              <tbody>
              </tbody>
      </table>
          <div class="fixed-action-btn" style="bottom: 45px; right: 24px;">
              <a href="#modal1" class="btn-floating btn-large teal tooltipped modal-trigger" data-position="left" data-delay="50" data-tooltip="Agregar vehiculo">
                  <i class="large mdi-content-add"></i></a>
          </div>
      </div>
    </div>

    <!-- modal form: alta rutas -->
    <div class="modal" id="modal1">
      <div class="modal-content">
        <h3 class="center">Registrar un vehículo nuevo</h3>
        <form class="col s12" id="form-id">
          <div class="row">
<!--
            <div class="input-field col s6">
              <input id="nombre" type="text" class="validate">
              <label for="nombre">Nombre</label>
            </div>
-->
            <div class="input-field col s6">
              <input id="marca" type="text" class="validate">
              <label for="marca">Marca</label>
            </div>
            <div class="input-field col s6">
              <input id="modelo" type="text" class="validate">
              <label for="modelo">Modelo</label>
            </div>
            <div class="input-field col s6">
              <input id="descripcion" type="text" class="validate">
              <label for="descripcion">Descripcion</label>
            </div>
            <div class="input-field col s6">
              <input id="placas" type="text" class="validate">
              <label for="placas">Placas</label>
            </div>
            <div class="input-field col s6">
              <input id="clasificacion" type="text" class="validate">
              <label for="clasificacion">Clasificacion</label>
            </div>
            <div class="input-field col s6">
              <input id="donante" type="text" class="validate">
              <label for="donante">Donante</label>
            </div>
            <div class="input-field col s6">
              <select id="gasolina">
                <option value="" disabled selected>Tipo de Combustible</option>
                <option value="magna">Magna</option>
                <option value="premium">Premium</option>
                <option value="diesel">Diesel</option>
              </select>
              <label>Ruta</label>
            </div>
            <div class="input-field col s6">
              <input id="numtarjeta" type="text" class="validate">
              <label for="numtarjeta">Número de Tarjeta</label>
            </div>
            <div class="input-field col s6">
              <input id="numholograma" type="text" class="validate">
              <label for="numholograma">Número de Holograma</label>
            </div>
            <div class="input-field col s6">
              <input id="numserie" type="text" class="validate">
              <label for="numserie">Número de Serie</label>
            </div>
            <div class="input-field col s6">
              <select id="disponible">
                <option value="" disabled selected>Disponibilidad</option>
                <option value="si">Si</option>
                <option value="no">No</option>
              </select>
              <label>Ruta</label>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat" id="submit-id" onclick="agregarABase()">Submit</a>
        <a href="#!" class="modal-action modal-close waves-effect waves-red btn-flat">Cancel</a>
      </div>
    </div>
    <!-- Termino del modal -->

    <script src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="../js/materialize.min.js"></script>
    <script src="../js/main.js"></script>
    <script>
      var path = './app/';
      var fs = require('fs');

      fs.watch(path, function() {
        if (location)
          location.reload();
      });
    </script>


    <script>
      window.onload = function() {
      	db = openDatabase('BAM', '1.0', 'database', 10 * 1024 * 1024);
      	db.transaction(function (tx) {
              tx.executeSql('CREATE TABLE IF NOT EXISTS vehiculos (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, Nombre, Marca, Modelo, Descripcion, Placas, Clasificacion, Donante, Combustible, NumTarjeta, NumHolograma, NumSerie, Estatus)');

              // tx.executeSql('INSERT INTO vehiculos (Nombre, Marca, Modelo, Descripcion, Placas, Clasificacion, Donante, Combustible, NumTarjeta, NumHolograma, NumSerie, Estatus) ' +
              // 'VALUES ("Carro1?", "Ford", "2008", "Ranger", "RE 78-067", "Carga Ligera", "Caritas", "Magna", "126002", "12120002", "ABCDEFGHIJK8", "Si")');


              // tx.executeSql('INSERT INTO vehiculos (Nombre, Marca, Modelo, Descripcion, Placas, Clasificacion, Donante, Combustible, NumTarjeta, NumHolograma, NumSerie, Estatus) ' +
              // 'VALUES ("carro2", "Ford", "2008", "Ranger", "RE 78-067", "Carga Ligera", "Caritas", "Magna", "126002", "12120002", "ABCDEFGHIJK8", "Si")');
          });

      	db.transaction(function (tx) {
          	tx.executeSql('SELECT * FROM vehiculos ORDER BY Lower(Nombre) ASC', [], function (tx, results) {
              	var len = results.rows.length, i;
              	$('#vehiculos tbody').html("");
              	var html='';
              	for (i = 0; i < len; i++) {
                  html+='<tr data-id="'+results.rows.item(i).id+'"><td>'+
                  results.rows.item(i).Nombre + '</td><td>' +
                  results.rows.item(i).Marca + '</td><td>' +
                  results.rows.item(i).Modelo + '</td><td>' +
                  results.rows.item(i).Descripcion + '</td><td>' +
                  results.rows.item(i).Placas + '</td><td>' +
                  results.rows.item(i).Clasificacion + '</td><td>' +
                  results.rows.item(i).Donante + '</td><td>' +
                  results.rows.item(i).Combustible + '</td><td>' +
                  results.rows.item(i).NumTarjeta + '</td><td>' +
                  results.rows.item(i).NumHolograma + '</td><td>' +
                  results.rows.item(i).NumSerie + '</td><td>' +
                  results.rows.item(i).Estatus + '</td>' +
                  '<td data-modify="0"><button class="btn waves-effect waves-light center editar-fila"><i class="mdi-editor-mode-edit"></i></button></td>' + 
                  '<td data-modify="0"><button class="btn waves-effect waves-light center red borrar-fila"><i class="mdi-action-delete"></i></button></td></tr>';
				}
				$("#vehiculos tbody").append(html);
          	});
      	});
      }
  	$(document).ready(function() {
        $('select').material_select();
      	$('.modal-trigger').leanModal({
        	dismissible: false
        });
      	$("#vehiculos").on("click","button",function() {
      		if($(this).hasClass('editar-fila')){
	          	var fila = $(this).parent().parent();
	          	var items = [null, null, null, null, null, null, null, null, null, null, null, null];

	          	fila.children().each(function(index, el) {
	          		if ($(this).data("modify") != "0") {
	          			console.log($(this).html());
	          			var txt = $(this).html();
	          			var width = txt.length + 2;
                        $(this).html("<input value='"+txt+"' size='"+width+"'/>");
	          		};
	          	});
				$(this).removeClass('editar-fila').addClass('green guardar-cambios');
				$(this).children().removeClass('mdi-editor-mode-edit').addClass('mdi-content-save');
			}
			else if ($(this).hasClass('guardar-cambios')){
				var fila = $(this).parent().parent();
	          	fila.children().each(function(index, el) {
	          		if ($(this).data("modify") != "0") {
	          			var newval = $(this).children().val();
	          			$(this).html(newval);
	          		};
	          	});
	          	$(this).removeClass('green guardar-cambios').addClass('editar-fila');
				$(this).children().removeClass('mdi-content-save').addClass('mdi-editor-mode-edit');
              var fila =$(this).parent().parent();
              guardarCambios(fila);
			}
			else if($(this).hasClass('borrar-fila')){
              if(confirm("¿Estas seguro que quieres borrar este registro?") == true) {
				var fila = $(this).parent().parent();
				var ID = fila.attr('data-id');
				db.transaction(function (tx) {
					tx.executeSql('DELETE FROM vehiculos WHERE id=' + ID);
        		});
				fila.html("");
              }
			}
  		});
	});
    function trim(value) {
        var temp = value;
        var obj = /^(\s*)([\W\w]*)(\b\s*$)/;
        if (obj.test(temp)) { temp = temp.replace(obj, '$2');}
        var obj = /  /g;
        while (temp.match(obj)) { temp = temp.replace(obj, " ");}
        return temp;
      }
    function agregarABase(){
      var form = document.getElementById("form-id");
      var marca = trim(form.marca.value);
      var modelo = trim(form.modelo.value);
      var descripcion = trim(form.descripcion.value);
      var placas = trim(form.placas.value);
      var clasificacion = trim(form.clasificacion.value);
      var donante = trim(form.donante.value);
      var gasolina = trim(form.gasolina.value);
      var numTarjeta = trim(form.numtarjeta.value);
      var numHolograma = trim(form.numholograma.value);
      var numSerie = trim(form.numserie.value);
      var disponible = trim(form.disponible.value);
      var nombre = marca+", "+descripcion+", ("+placas+")";
      
      if(nombre == "" || marca=="" || modelo=="" || descripcion=="" || placas=="" || clasificacion=="" || donante=="" || gasolina=="" || numTarjeta=="" || numHolograma=="" || numSerie=="" || disponible==""){
          alert("Por favor llena todos los campos");
          return false;
      }
      db.transaction(function (tx) {
          tx.executeSql('INSERT INTO vehiculos VALUES (NULL, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);',
                  [nombre, marca, modelo, descripcion, placas, clasificacion, donante, gasolina, numTarjeta, numHolograma, numSerie, disponible]);
      });
      location.reload();
      return true;
    }


       function guardarCambios(fila) {
         fila = fila[0];
         var nombre = fila.children[0].innerText;
         var marca = fila.children[1].innerText;
        var modelo = fila.children[2].innerText;
        var descripcion = fila.children[3].innerText;
        var placas = fila.children[4].innerText;
        var clasificacion = fila.children[5].innerText;
        var donante = fila.children[6].innerText;
        var gasolina = fila.children[7].innerText;
        var numTarjeta = fila.children[8].innerText;
        var numHolograma = fila.children[9].innerText;
        var numSerie = fila.children[10].innerText;
        var disponible = fila.children[11].innerText;
         var ID = fila.getAttribute("data-id");
         db.transaction(function (tx) {
            tx.executeSql('UPDATE vehiculos SET Nombre =?, Marca=?, Modelo=?, Descripcion=?, Placas=?, Clasificacion=?, Donante=?, Combustible=?, NumTarjeta=?, NumHolograma=?, NumSerie=?, Estatus=? WHERE id =?',
            [nombre, marca, modelo, descripcion, placas, clasificacion, donante, gasolina, numTarjeta, numHolograma, numSerie, disponible, parseInt(ID)]);
        });
         
       }








    </script>

  </body>
</html>
